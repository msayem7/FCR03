"use strict";(self["webpackChunkcrf03"]=self["webpackChunkcrf03"]||[]).push([[13],{4013:function(e,a,t){t.r(a),t.d(a,{default:function(){return j}});t(4114),t(8992),t(4520),t(3949),t(1454),t(4603),t(7566),t(8721);var l=t(6768),u=t(4232),s=t(5130),c=t(144),o=t(1387),n=t(8082),r=t(8299),i=t(5875);const d={class:"container mt-4"},v={class:"mb-4"},m={class:"row g-3"},h={class:"col-md-6 form-floating"},p=["disabled"],k={key:0,value:"",disabled:""},f=["value"],b={key:0,class:"text-danger mt-1"},L={class:"col-md-6 form-floating"},_={class:"col-md-4 form-floating"},q={class:"col-md-4 form-floating"},g={class:"col-md-4 form-floating"},y=["value"],C={class:"col-12 form-floating"},w={key:0,class:"col-12"},E=["src"],I={key:1,class:"col-12"},R=["src"],S={class:"col-12"},x={key:0,class:"card"},D={class:"card-body"},K={class:"table"},X=["onUpdate:modelValue","onChange"],A={class:"col-12"};var U={__name:"ChequeEntryView",setup(e){const a=(0,i.x)(),t=(0,o.lq)(),U=(0,o.rd)(),V=(0,l.EW)((()=>!!t.params.aliasId)),F=(0,c.KR)(!0),j=(0,c.KR)(null),B=(0,c.KR)({customer:"",received_date:(new Date).toISOString().split("T")[0],cheque_amount:0,cheque_date:null,cheque_status:1,cheque_image:null,version:1}),J=(0,c.KR)(null),O=(0,c.KR)(null),$=(0,c.KR)(!1),Q=(0,c.KR)([]),N=(0,c.KR)({}),T=(0,c.KR)([]),P=[{value:1,text:"Received"},{value:2,text:"Deposited"},{value:3,text:"Honored"},{value:4,text:"Dishonored"},{value:5,text:"Canceled"}],W=e=>{const a=e.target.files[0];a&&(B.value.cheque_image=a,J.value=URL.createObjectURL(a))},H=async()=>{try{const e={is_active:!0,branch:a.selectedBranch},{data:t}=await n.A.get("/customers/",{params:e});T.value=t,F.value=!0}catch(e){j.value="Failed to load customers. Please try again later."}finally{F.value=!1}},Y=async()=>{if(!B.value.customer)return alert("Select customer first");try{const{data:e}=await n.A.get(`/credit-invoices/?customer=${B.value.customer}&status=true`);Q.value=e,$.value=!0}catch(e){alert(e.message)}},z=e=>{new Date(B.value.received_date)<new Date(e.transaction_date)&&(alert("Cheque date must be after invoice date"),N.value[e.alias_id]=0)},G=async()=>{try{const e=localStorage.getItem("workingBranch");if(!e)throw new Error("Select a branch first");const a=new FormData;Object.entries(B.value).forEach((([e,t])=>{("cheque_image"!==e||t)&&a.append(e,t)})),a.append("branch",e);const l=Object.entries(N.value).filter((([e,a])=>a>0)).map((([e,a])=>{const t=parseFloat(a);if(isNaN(t))throw new Error(`Invalid amount for invoice ${e}`);return{creditinvoice:e,adjusted_amount:t}}));a.append("invoice_cheques",JSON.stringify(l)),t.params.aliasId?await n.A.put(`/cheques/${t.params.aliasId}/`,a,{headers:{"Content-Type":"multipart/form-data"}}):await n.A.post("/cheques/",a,{headers:{"Content-Type":"multipart/form-data"}}),U.push("/cheques")}catch(e){alert(e.response?.data?.error||e.message)}};return(0,l.wB)((()=>a.selectedBranch),((e,a)=>{a&&e!==a&&(alert("Branch has changed. Redirecting to cheque list."),U.push("/cheques"))}),{immediate:!0}),(0,l.wB)((()=>B.value.customer),((e,a)=>{a&&e!==a&&(Q.value=[],N.value={},$.value=!1)}),{immediate:!0}),(0,l.sV)((async()=>{if(H(),V.value=!!t.params.aliasId,t.params.aliasId){const{data:e}=await n.A.get(`/cheques/${t.params.aliasId}/`,{params:{include_invoice_cheques:!0}});B.value={...e,customer:e.customer,version:e.version},e.invoice_cheques&&e.invoice_cheques.forEach((e=>{N.value[e.creditinvoice]=e.adjusted_amount})),e.cheque_image&&(O.value=e.cheque_image)}})),(e,a)=>{const t=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",d,[(0,l.Lk)("h2",v,(0,u.v_)(V.value?"Edit":"Create")+" Cheque",1),(0,l.Lk)("form",{onSubmit:(0,s.D$)(G,["prevent"])},[(0,l.Lk)("div",m,[(0,l.Lk)("div",h,[(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>B.value.customer=e),class:"form-select",id:"customerSelect",required:"",disabled:F.value},[F.value?((0,l.uX)(),(0,l.CE)("option",k," Loading customers... ")):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[a[5]||(a[5]=(0,l.Lk)("option",{value:"",disabled:"",hidden:""},"Select customer",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(T.value,(e=>((0,l.uX)(),(0,l.CE)("option",{value:e.alias_id,key:e.alias_id},(0,u.v_)(e.name),9,f)))),128))],64))],8,p),[[s.u1,B.value.customer]]),a[6]||(a[6]=(0,l.Lk)("label",{for:"customerSelect"},"Customer",-1)),j.value?((0,l.uX)(),(0,l.CE)("div",b,(0,u.v_)(j.value),1)):(0,l.Q3)("",!0)]),(0,l.Lk)("div",L,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>B.value.received_date=e),type:"date",class:"form-control",id:"receivedDate",required:""},null,512),[[s.Jo,B.value.received_date]]),a[7]||(a[7]=(0,l.Lk)("label",{for:"receivedDate"},"Received Date",-1))]),(0,l.Lk)("div",_,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>B.value.cheque_amount=e),type:"number",step:"0.01",class:"form-control",id:"chequeAmount",required:""},null,512),[[s.Jo,B.value.cheque_amount]]),a[8]||(a[8]=(0,l.Lk)("label",{for:"chequeAmount"},"Amount",-1))]),(0,l.Lk)("div",q,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>B.value.cheque_date=e),type:"date",class:"form-control",id:"chequeDate"},null,512),[[s.Jo,B.value.cheque_date]]),a[9]||(a[9]=(0,l.Lk)("label",{for:"chequeDate"},"Cheque Date",-1))]),(0,l.Lk)("div",g,[(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>B.value.cheque_status=e),class:"form-select",id:"chequeStatus"},[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)(P,(e=>(0,l.Lk)("option",{value:e.value,key:e.value},(0,u.v_)(e.text),9,y))),64))],512),[[s.u1,B.value.cheque_status]]),a[10]||(a[10]=(0,l.Lk)("label",{for:"chequeStatus"},"Status",-1))]),(0,l.Lk)("div",C,[(0,l.Lk)("input",{type:"file",onChange:W,class:"form-control",id:"chequeImage",accept:"image/*"},null,32),a[11]||(a[11]=(0,l.Lk)("label",{for:"chequeImage"},"Cheque Image",-1))]),J.value?((0,l.uX)(),(0,l.CE)("div",w,[a[12]||(a[12]=(0,l.Lk)("h6",{class:"text-muted mb-2"},"Preview:",-1)),(0,l.Lk)("img",{src:J.value,class:"img-thumbnail",style:{"max-width":"300px"}},null,8,E)])):(0,l.Q3)("",!0),O.value?((0,l.uX)(),(0,l.CE)("div",I,[a[13]||(a[13]=(0,l.Lk)("h6",{class:"text-muted mb-2"},"Current Image:",-1)),(0,l.Lk)("img",{src:O.value,class:"img-thumbnail",style:{"max-width":"300px"}},null,8,R)])):(0,l.Q3)("",!0),(0,l.Lk)("div",S,[(0,l.Lk)("button",{type:"button",onClick:Y,class:"btn btn-secondary mb-3"}," Show Invoices "),$.value?((0,l.uX)(),(0,l.CE)("div",x,[(0,l.Lk)("div",D,[(0,l.Lk)("table",K,[a[14]||(a[14]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Invoice #"),(0,l.Lk)("th",null,"Date"),(0,l.Lk)("th",null,"Amount"),(0,l.Lk)("th",null,"Adjustment")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(Q.value,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.alias_id},[(0,l.Lk)("td",null,(0,u.v_)(e.invoice_no),1),(0,l.Lk)("td",null,(0,u.v_)((0,c.R1)(r.Y)(e.transaction_date)),1),(0,l.Lk)("td",null,(0,u.v_)(e.due_amount),1),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":a=>N.value[e.alias_id]=a,min:"0",step:"0.01",class:"form-control",onChange:a=>z(e)},null,40,X),[[s.Jo,N.value[e.alias_id]]])])])))),128))])])])])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",A,[a[16]||(a[16]=(0,l.Lk)("button",{type:"submit",class:"btn btn-primary me-2"},"Save",-1)),(0,l.bF)(t,{to:"/cheques",class:"btn btn-secondary"},{default:(0,l.k6)((()=>a[15]||(a[15]=[(0,l.eW)("Cancel")]))),_:1})])])],32)])}}},V=t(1241);const F=(0,V.A)(U,[["__scopeId","data-v-8f00a51c"]]);var j=F}}]);
//# sourceMappingURL=13.6f4f59ce.js.map