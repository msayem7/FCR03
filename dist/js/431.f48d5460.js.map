{"version":3,"file":"js/431.f48d5460.js","mappings":"4dAkDA,MAAMA,GAAQC,EAAAA,EAAAA,MACRC,GAASC,EAAAA,EAAAA,MAETC,GAAYC,EAAAA,EAAAA,KAAS,IAAML,EAAMM,KAAKC,SAAS,YAC/CC,EAAgB,CAAE,EAAG,cAAe,EAAG,UAEvCC,GAAWC,EAAAA,EAAAA,IAAI,CACnBC,KAAM,GACNC,YAAa,EACbC,OAAQ,KACRC,QAAS,GACTC,QAAS,GACTC,QAAS,IAGLC,GAAWP,EAAAA,EAAAA,IAAI,IAEfQ,GAAmBb,EAAAA,EAAAA,KAAS,IACzBY,EAASE,MAAMC,QAAOC,GAAKA,EAAEC,WAAatB,EAAMuB,OAAOC,YAG1DC,EAAeC,UACnB,IACE,MAAM,KAAEC,SAAeC,EAAAA,EAAMC,IAAI,cACjCZ,EAASE,MAAQQ,CACnB,CAAE,MAAOG,GACPC,QAAQD,MAAM,0BAA2BA,EAC3C,GAGIE,EAAeN,UACnB,IACE,MAAMO,EAAU,IACXxB,EAASU,MACZH,QAASP,EAASU,MAAMH,SAGtBZ,EAAUe,YACNS,EAAAA,EAAMM,IAAI,aAAalC,EAAMuB,OAAOC,WAAYS,SAEhDL,EAAAA,EAAMO,KAAK,aAAcF,GAEjC/B,EAAOkC,KAAK,YAEd,CAAE,MAAON,GACwB,MAA3BA,EAAMO,UAAUC,SAClBC,MAAM,6DACAd,IAEV,G,OAGFe,EAAAA,EAAAA,KAAUd,UAER,SADMD,IACFrB,EAAUe,MAAO,CACnB,MAAM,KAAEQ,SAAeC,EAAAA,EAAMC,IAAI,aAAa7B,EAAMuB,OAAOC,YAC3Df,EAASU,MAAQQ,CACnB,K,kyCCxGF,MAAMc,EAAc,EAEpB,O","sources":["webpack://crf03/./src/views/BranchFormView.vue","webpack://crf03/./src/views/BranchFormView.vue?56ef"],"sourcesContent":["<template>\r\n  <div class=\"container mt-4\">\r\n    <h2>{{ isEditing ? 'Edit' : 'Create' }} Branch</h2>\r\n    \r\n    <form @submit.prevent=\"handleSubmit\">\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\">\r\n          <label class=\"form-label\">Branch Name</label>\r\n          <input v-model=\"formData.name\" type=\"text\" class=\"form-control\" required>\r\n        </div>\r\n\r\n        <div class=\"col-md-6\">\r\n          <label class=\"form-label\">Branch Type</label>\r\n          <select v-model=\"formData.branch_type\" class=\"form-select\" required>\r\n            <option v-for=\"(label, value) in branchTypeMap\" \r\n                    :key=\"value\" \r\n                    :value=\"value\">\r\n              {{ label }}\r\n            </option>\r\n          </select>\r\n        </div>\r\n\r\n        <div class=\"col-12\">\r\n          <label class=\"form-label\">Parent Branch</label>\r\n          <select v-model=\"formData.parent\" class=\"form-select\">\r\n            <option :value=\"null\">No Parent</option>\r\n            <option v-for=\"branch in availableParents\" \r\n                    :key=\"branch.alias_id\" \r\n                    :value=\"branch.alias_id\">\r\n              {{ branch.name }}\r\n            </option>\r\n          </select>\r\n        </div>\r\n        <!-- Add address and contact fields -->\r\n        <div class=\"col-12\">\r\n          <button type=\"submit\" class=\"btn btn-primary\">\r\n            {{ isEditing ? 'Update' : 'Create' }} Branch\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport axios from '@/plugins/axios'\r\n\r\nconst route = useRoute()\r\nconst router = useRouter()\r\n\r\nconst isEditing = computed(() => route.path.includes('/edit/'))\r\nconst branchTypeMap = { 1: 'Head Office', 2: 'Branch' }\r\n\r\nconst formData = ref({\r\n  name: '',\r\n  branch_type: 2,\r\n  parent: null,\r\n  address: '',\r\n  contact: '',\r\n  version: 1\r\n})\r\n\r\nconst branches = ref([])\r\n\r\nconst availableParents = computed(() => {\r\n  return branches.value.filter(b => b.alias_id !== route.params.aliasId)\r\n})\r\n\r\nconst loadBranches = async () => {\r\n  try {\r\n    const { data } = await axios.get('/branches/')\r\n    branches.value = data\r\n  } catch (error) {\r\n    console.error('Error loading branches:', error)\r\n  }\r\n}\r\n\r\nconst handleSubmit = async () => {\r\n  try {\r\n    const payload = {\r\n      ...formData.value,\r\n      version: formData.value.version // Make sure to send current version\r\n    }\r\n    \r\n    if (isEditing.value) {\r\n      await axios.put(`/branches/${route.params.aliasId}/`, payload)\r\n    } else {\r\n      await axios.post('/branches/', payload)\r\n    }\r\n    router.push('/branches')\r\n\r\n  } catch (error) {\r\n    if (error.response?.status === 409) {\r\n      alert('Concurrency conflict. Please refresh and try again.')\r\n      await loadBranches() // Refresh data\r\n    }\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  await loadBranches()\r\n  if (isEditing.value) {\r\n    const { data } = await axios.get(`/branches/${route.params.aliasId}/`)\r\n    formData.value = data\r\n  }\r\n})\r\n</script>","import script from \"./BranchFormView.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./BranchFormView.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["route","useRoute","router","useRouter","isEditing","computed","path","includes","branchTypeMap","formData","ref","name","branch_type","parent","address","contact","version","branches","availableParents","value","filter","b","alias_id","params","aliasId","loadBranches","async","data","axios","get","error","console","handleSubmit","payload","put","post","push","response","status","alert","onMounted","__exports__"],"sourceRoot":""}